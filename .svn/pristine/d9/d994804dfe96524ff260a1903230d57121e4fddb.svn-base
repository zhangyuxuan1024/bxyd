package net.iclassmate.xydspace.ui.activity.constacts;

import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.support.v4.app.FragmentActivity;
import android.text.Editable;
import android.text.TextWatcher;
import android.view.View;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;
import android.widget.Toast;

import net.iclassmate.xydspace.R;
import net.iclassmate.xydspace.utils.UIUtils;
import net.iclassmate.xydspace.view.TitleBar;

public class AddFriendActivity extends FragmentActivity implements TitleBar.TitleOnClickListener, View.OnClickListener {
    private Context mContext;
    private TitleBar titleBar;
    private EditText addFriend;
    private ImageView mDelete;
    private TextView mPerson, mGroup, mOrg;
    private LinearLayout addLayout, searchLayout;
    private RelativeLayout sao, phoneContacts, addPerson, addGroup, addOrg;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_add_friend);
        mContext = this;
        initView();
        initData();
        initListener();
    }

    private void initView() {
        titleBar = (TitleBar) findViewById(R.id.addFriend_title_bar);
        titleBar.setLeftIcon("取消");
        titleBar.setTitleClickListener(this);

        mPerson = (TextView) findViewById(R.id.person_code);
        mGroup = (TextView) findViewById(R.id.group_code);
        mOrg = (TextView) findViewById(R.id.org_code);
        mDelete = (ImageView) findViewById(R.id.addFriend_delete);
        addFriend = (EditText) findViewById(R.id.addFriend_et);
        sao = (RelativeLayout) findViewById(R.id.add_sao_layout);
        phoneContacts = (RelativeLayout) findViewById(R.id.phone_contacts_layout);
        addLayout = (LinearLayout) findViewById(R.id.addFriend_layout1);
        searchLayout = (LinearLayout) findViewById(R.id.addFriend_layout2);
        addPerson = (RelativeLayout) findViewById(R.id.person_contacts_layout);
        addGroup = (RelativeLayout) findViewById(R.id.group_contacts_layout);
        addOrg = (RelativeLayout) findViewById(R.id.org_contacts_layout);
    }

    private void initData() {

    }

    private void initListener() {
        sao.setOnClickListener(this);
        phoneContacts.setOnClickListener(this);
        mDelete.setOnClickListener(this);
        addPerson.setOnClickListener(this);
        addGroup.setOnClickListener(this);
        addOrg.setOnClickListener(this);

        addFriend.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (s.length() != 0) {
                    addLayout.setVisibility(View.GONE);
                    searchLayout.setVisibility(View.VISIBLE);
                    mDelete.setVisibility(View.VISIBLE);
                    String code = addFriend.getText().toString().trim();
                    mPerson.setText(code);
                    mGroup.setText(code);
                    mOrg.setText(code);
                } else {
                    addLayout.setVisibility(View.VISIBLE);
                    searchLayout.setVisibility(View.GONE);
                    mDelete.setVisibility(View.INVISIBLE);
                }

            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });

    }

    private void searchByNumber(final String s) {


        new Thread(new Runnable() {
            @Override
            public void run() {
//                httpManager.findUserInfo(s);
            }
        }).start();

    }


    @Override
    public void leftClick() {
        close();
    }

    @Override
    public void onBackPressed() {
        close();
    }

    private void close() {
        Intent intent = new Intent();
        setResult(RESULT_OK, intent);
        finish();
    }

    @Override
    public void rightClick() {

    }

    @Override
    public void titleClick() {

    }

    @Override
    public void innerleftClick() {

    }

    @Override
    public void innerRightClick() {

    }

    @Override
    public void onClick(View v) {
        switch (v.getId()) {
            case R.id.add_sao_layout:
                Toast.makeText(UIUtils.getContext(), "扫一扫", Toast.LENGTH_SHORT).show();
                break;
            case R.id.phone_contacts_layout:
                Toast.makeText(UIUtils.getContext(), "手机联系人", Toast.LENGTH_SHORT).show();
                Intent intent = new Intent(AddFriendActivity.this, PhoneContactActivity.class);
                startActivity(intent);
                break;
            case R.id.person_contacts_layout:
                String personKey = addFriend.getText().toString().trim();
                Intent searchPerson = new Intent(UIUtils.getContext(), FriendResActivity.class);
                searchPerson.putExtra("type", "person");
                searchPerson.putExtra("key", personKey);
                startActivity(searchPerson);
                break;
            case R.id.group_contacts_layout:
                String groupKey = addFriend.getText().toString().trim();
                Intent searchGroup = new Intent(UIUtils.getContext(), FriendResActivity.class);
                searchGroup.putExtra("type", "group");
                searchGroup.putExtra("key", groupKey);
                startActivity(searchGroup);
                break;
            case R.id.org_contacts_layout:
                String orgKey = addFriend.getText().toString().trim();
                Intent searchOrg = new Intent(UIUtils.getContext(), FriendResActivity.class);
                searchOrg.putExtra("type", "org");
                searchOrg.putExtra("key", orgKey);
                startActivity(searchOrg);
                break;
            case R.id.addFriend_delete:
                addFriend.setText("");
                break;
        }
    }
}
